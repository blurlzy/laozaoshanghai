<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Sign In with Auth0</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
	a {
		text-decoration: none;
	}

	.login-page {
		width: 100%;
		height: 100vh;
		display: inline-block;
		display: flex;
		align-items: center;
	}

	.form-right i {
		font-size: 100px;
	}

	#error-message {
		display: none;
		white-space: break-spaces;
	}
</style>

<body>
	<div class="login-page bg-light">
		<div class="container">
			<div class="row">
				<div class="col-lg-10 offset-lg-1">
					<h3 class="mb-3">老早上海</h3>
					<div class="bg-white shadow rounded-3">
						<div class="row">
							<div class="col-md-5 pe-0">
								<div class="form-left h-100 py-5 px-5">
									<form onsubmit="return false;" method="post" class="row g-4">
										<div class="col-12">
											<input type="email" id="email" class="form-control" placeholder="用户名" required autofocus>
										</div>
	
										<div class="col-12">
											<input type="password" id="password" class="form-control" placeholder="密码" required>
										</div>
										<div id="error-message" class="alert alert-danger"></div>
										<div class="captcha-container form-group"></div>

										<div class="col-12">
											<div class="d-grid gap-2">
												<button id="btn-login" class="btn btn-primary btn-lg" type="button">登录</button>
											</div>										
										</div>
									</form>
								</div>
							</div>
							<div class="col-md-7 ps-0 d-none d-md-block">
								<div class="form-right text-center">
									<img src="https://stlaoshanghaiprod.blob.core.windows.net/photos/91ff3f2e-df88-442c-a45d-faa3b4f24f66.png" class="img-fluid rounded-3 ms-2">
								</div>
							</div>
						</div>
					</div>
					<p class="text-end text-secondary mt-3">&copy; LaozaoShanghai 管理后台  </p>
				</div>
			</div>
		</div>
	</div>

	<!--[if IE 8]>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ie8/0.2.5/ie8.js"></script>
	<![endif]-->

	<!--[if lte IE 9]>
	<script src="https://cdn.auth0.com/js/polyfills/1.0/base64.min.js"></script>
	<script src="https://cdn.auth0.com/js/polyfills/1.0/es5-shim.min.js"></script>
	<![endif]-->

	<script src="https://cdn.auth0.com/js/auth0/9.18/auth0.min.js"></script>
	<script src="https://cdn.auth0.com/js/polyfills/1.0/object-assign.min.js"></script>
	<script>
		window.addEventListener('load', function () {

			var config = JSON.parse(
				decodeURIComponent(escape(window.atob('@@config@@')))
			);

			var leeway = config.internalOptions.leeway;
			if (leeway) {
				var convertedLeeway = parseInt(leeway);

				if (!isNaN(convertedLeeway)) {
					config.internalOptions.leeway = convertedLeeway;
				}
			}

			var params = Object.assign({
				overrides: {
					__tenant: config.auth0Tenant,
					__token_issuer: config.authorizationServer.issuer
				},
				domain: config.auth0Domain,
				clientID: config.clientID,
				redirectUri: config.callbackURL,
				responseType: 'code'
			}, config.internalOptions);

			var webAuth = new auth0.WebAuth(params);
			var databaseConnection = 'Username-Password-Authentication';
			var captcha = webAuth.renderCaptcha(
				document.querySelector('.captcha-container')
			);

			function login(e) {
				e.preventDefault();
				var button = this;
				var username = document.getElementById('email').value;
				var password = document.getElementById('password').value;
				button.disabled = true;
				webAuth.login({
					realm: databaseConnection,
					username: username,
					password: password,
					captcha: captcha.getValue()
				}, function (err) {
					if (err) displayError(err);
					button.disabled = false;
				});
			}

			// function signup() {
			// 	var button = this;
			// 	var email = document.getElementById('email').value;
			// 	var password = document.getElementById('password').value;

			// 	button.disabled = true;
			// 	webAuth.redirect.signupAndLogin({
			// 		connection: databaseConnection,
			// 		email: email,
			// 		password: password,
			// 		captcha: captcha.getValue()
			// 	}, function (err) {
			// 		if (err) displayError(err);
			// 		button.disabled = false;
			// 	});
			// }

			// function loginWithGoogle() {
			// 	webAuth.authorize({
			// 		connection: 'google-oauth2'
			// 	}, function (err) {
			// 		if (err) displayError(err);
			// 	});
			// }

			function displayError(err) {
				captcha.reload();
				var errorMessage = document.getElementById('error-message');
				errorMessage.innerHTML = err.policy || err.description;
				errorMessage.style.display = 'block';
			}

			document.getElementById('btn-login').addEventListener('click', login);
		});
	</script>
</body>

</html>